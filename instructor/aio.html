<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="de" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>HPC Workflow Management with Snakemake: Alles auf einen Blick</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/incubator/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicons/incubator/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicons/incubator/favicon-16x16.png">
<link rel="manifest" href="../favicons/incubator/site.webmanifest">
<link rel="mask-icon" href="../favicons/incubator/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Zum Hauptinhalt springen</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="Diese Lektion befindet sich in der Pre-Alpha-Phase, was bedeutet, dass sie sich in einer frühen Entwicklungsphase befindet, aber noch nicht unterrichtet wurde.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">Diese Lektion befindet sich in der Pre-Alpha-Phase, was bedeutet, dass sie sich in einer frühen Entwicklungsphase befindet, aber noch nicht unterrichtet wurde.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Thema umschalten (automatisch)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Dozentenansicht <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Lernansicht</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Hauptnavigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Navigation umschalten">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menü</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      HPC Workflow Management with Snakemake
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Suche auf der All-In-One-Seite" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            HPC Workflow Management with Snakemake
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Hauptpunkte</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Dozentennotizen</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Alle Bilder extrahieren</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            Mehr <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<hr>
<li><a class="dropdown-item" href="reference.html">Referenz</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Suche auf der All-In-One-Seite"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Suche auf der All-In-One-Seite">Suche auf der All-In-One-Seite</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  HPC Workflow Management with Snakemake
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lernfortschritt" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="Menü schließen" alt="Menü schließen" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Ausblenden " data-episodes="Episoden ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Dozentenansicht
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Lernansicht</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODEN
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Zusammenfassung und Zeitplan</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-introduction.html">1. Ausführen von Befehlen mit Snakemake</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-snakemake_on_the_cluster.html">2. Ausführen von Snakemake auf dem Cluster</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-placeholders.html">3. Platzhalter</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-snakemake_and_mpi.html">4. MPI-Anwendungen und Snakemake</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-chaining_rules.html">5. Verkettung von Regeln</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-expansion.html">6. Verarbeitung von Listen von Eingaben</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESSOURCEN
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Hauptpunkte</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Dozentennotizen</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Alle Bilder extrahieren</a>
                      </li>
                      <hr>
<li><a class="dropdown-item" href="reference.html">Referenz</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="../instructor/aio.html">Alles auf einer Seite sehen</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-introduction"><p>Content from <a href="01-introduction.html">Ausführen von Befehlen mit Snakemake</a></p>
<hr>
<p>Zuletzt aktualisiert am 2024-11-25 |

        <a href="https://github.com/carpentries-incubator/hpc-workflows/edit/main/episodes/01-introduction.md" class="external-link">Diese Seite bearbeiten <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Geschätzte Zeit: <i aria-hidden="true" data-feather="clock"></i> 60 Minuten</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Alle Lösungen anzeigen " data-collapse="Alle Lösungen ausblenden "> Alle Lösungen anzeigen <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Übersicht</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Fragen</h3>
<ul>
<li>“Wie führe ich einen einfachen Befehl mit Snakemake aus?”</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Ziele</h3>
<ul>
<li>“Erstelle ein Snakemake-Rezept (eine Snake-Datei)”</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="für-welchen-arbeitsablauf-interessiere-ich-mich">Für welchen Arbeitsablauf interessiere ich mich?<a class="anchor" aria-label="anchor" href="#f%C3%BCr-welchen-arbeitsablauf-interessiere-ich-mich"></a>
</h2>
<hr class="half-width">
<p>In dieser Lektion werden wir ein Experiment durchführen, bei dem wir
eine parallel laufende Anwendung auf ihre Skalierbarkeit hin
untersuchen. Dazu müssen wir Daten sammeln. In diesem Fall bedeutet das,
dass wir die Anwendung mehrmals mit einer unterschiedlichen Anzahl von
CPU-Kernen ausführen und die Ausführungszeit aufzeichnen. Danach müssen
wir eine Visualisierung der Daten erstellen, um zu sehen, wie sie sich
im Vergleich zum Idealfall verhalten.</p>
<p>Anhand der Visualisierung können wir dann entscheiden, in welchem
Maßstab es am sinnvollsten ist, die Anwendung in der Produktion laufen
zu lassen, um die CPU-Zuweisung auf dem System optimal zu nutzen.</p>
<p>Wir könnten all dies manuell tun, aber es gibt nützliche Tools, die
uns bei der Verwaltung von Datenanalyse-Pipelines, wie wir sie in
unserem Experiment haben, helfen. Heute werden wir eines dieser Tools
kennenlernen: Snakemake.</p>
<p>Um mit Snakemake zu beginnen, nehmen wir zunächst einen einfachen
Befehl und sehen, wie wir ihn mit Snakemake ausführen können. Wählen wir
den Befehl <code>hostname</code>, der den Namen des Rechners ausgibt,
auf dem der Befehl ausgeführt wird:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">[ocaisa@node1</span> ~]$ hostname</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">AUSGABE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">node1.int.jetstream2.hpc</span><span class="op">-</span><span class="va">carpentry.org</span></span></code></pre>
</div>
<p>Das gibt das Ergebnis aus, aber Snakemake ist auf Dateien angewiesen,
um den Status Ihres Arbeitsablaufs zu kennen, also leiten wir die
Ausgabe in eine Datei um:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">[ocaisa@node1</span> ~]$ hostname <span class="op">&gt;</span> hostname_login.txt</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="erstellen-einer-snake-datei">Erstellen einer Snake-Datei<a class="anchor" aria-label="anchor" href="#erstellen-einer-snake-datei"></a>
</h2>
<hr class="half-width">
<p>Bearbeiten Sie eine neue Textdatei mit dem Namen
<code>Snakefile</code>.</p>
<p>Inhalt von <code>Snakefile</code>:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>rule hostname_login:</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    output: <span class="st">"hostname_login.txt"</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    <span class="bu">input</span>:  </span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    shell:</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>        <span class="co">"hostname &gt; hostname_login.txt"</span></span></code></pre>
</div>
<div id="wichtige-punkte-zu-dieser-datei" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="wichtige-punkte-zu-dieser-datei" class="callout-inner">
<h3 class="callout-title">Wichtige Punkte zu dieser Datei</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Die Datei heißt <code>Snakefile</code> - mit einem großen
<code>S</code> und ohne Dateierweiterung.</li>
<li>Einige Zeilen sind eingerückt. Einrückungen müssen mit Leerzeichen,
nicht mit Tabulatoren erfolgen. Wie Sie Ihren Texteditor dazu bringen,
dies zu tun, erfahren Sie im Abschnitt “Setup”.</li>
<li>Die Regeldefinition beginnt mit dem Schlüsselwort <code>rule</code>,
gefolgt von dem Namen der Regel und einem Doppelpunkt.</li>
<li>Wir haben die Regel <code>hostname_login</code> genannt. Sie können
Buchstaben, Zahlen oder Unterstriche verwenden, aber der Name der Regel
muss mit einem Buchstaben beginnen und darf kein Schlüsselwort
sein.</li>
<li>Die Schlüsselwörter <code>input</code>, <code>output</code> und
<code>shell</code> werden alle von einem Doppelpunkt (“:”) gefolgt.</li>
<li>Die Dateinamen und der Shell-Befehl sind alle in
<code>"quotes"</code>.</li>
<li>Der Name der Ausgabedatei wird vor dem Namen der Eingabedatei
angegeben. Eigentlich ist es Snakemake egal, in welcher Reihenfolge sie
erscheinen, aber wir geben in diesem Kurs die Ausgabe zuerst an. Wir
werden gleich sehen, warum.</li>
<li>In diesem Anwendungsfall gibt es keine Eingabedatei für den Befehl,
also lassen wir dieses Feld leer.</li>
</ol>
</div>
</div>
</div>
<p>Zurück in der Shell werden wir unsere neue Regel ausführen. An diesem
Punkt, wenn es irgendwelche fehlenden Anführungszeichen, falsche
Einrückungen, etc. gab, werden wir einen Fehler sehen.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">snakemake</span> <span class="at">-j1</span> <span class="at">-p</span> hostname_login</span></code></pre>
</div>
<div id="bash-snakemake-command-not-found..." class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="bash-snakemake-command-not-found..." class="callout-inner">
<h3 class="callout-title"><code>bash: snakemake: command not found...</code></h3>
<div class="callout-content">
<p>Wenn Ihre Shell Ihnen mitteilt, dass sie den Befehl
<code>snakemake</code> nicht finden kann, müssen wir die Software
irgendwie verfügbar machen. In unserem Fall bedeutet das, dass wir nach
dem Modul suchen müssen, das wir laden wollen:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">module</span> spider snakemake</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">AUSGABE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[ocaisa@node1 ~]$ module spider snakemake

--------------------------------------------------------------------------------------------------------
  snakemake:
--------------------------------------------------------------------------------------------------------
     Versions:
        snakemake/8.2.1-foss-2023a
        snakemake/8.2.1 (E)

Names marked by a trailing (E) are extensions provided by another module.


--------------------------------------------------------------------------------------------------------
  For detailed information about a specific "snakemake" package (including how to load the modules) use the module's full name.
  Note that names that have a trailing (E) are extensions provided by other modules.
  For example:

     $ module spider snakemake/8.2.1
--------------------------------------------------------------------------------------------------------</code></pre>
</div>
<p>Jetzt wollen wir das Modul, also laden wir es, um das Paket verfügbar
zu machen</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">[ocaisa@node1</span> ~]$ module load snakemake</span></code></pre>
</div>
<p>und dann stellen Sie sicher, dass der Befehl <code>snakemake</code>
verfügbar ist</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">[ocaisa@node1</span> ~]$ which snakemake</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">AUSGABE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>/cvmfs/software.eessi.io/host_injections/2023.06/software/linux/x86_64/amd/zen3/software/snakemake/8.2.1-foss-2023a/bin/snakemake</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">snakemake</span> <span class="at">-j1</span> <span class="at">-p</span> hostname_login</span></code></pre>
</div>
</div>
</div>
</div>
<div id="ausführen-von-snakemake" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="ausführen-von-snakemake" class="callout-inner">
<h3 class="callout-title">Ausführen von Snakemake</h3>
<div class="callout-content">
<p>Führen Sie <code>snakemake --help | less</code> aus, um die Hilfe für
alle verfügbaren Optionen zu sehen. Was bewirkt die Option
<code>-p</code> in dem obigen Befehl <code>snakemake</code>?</p>
<ol style="list-style-type: decimal">
<li>Schützt bestehende Ausgabedateien</li>
<li>Gibt die Shell-Befehle, die gerade ausgeführt werden, auf dem
Terminal aus</li>
<li>Sagt Snakemake, dass es nur einen Prozess auf einmal ausführen
soll</li>
<li>Fordert den Benutzer auf, die richtige Eingabedatei zu wählen</li>
</ol>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Gib mir einen Hinweis </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" aria-labelledby="headingHint1" data-bs-parent="#accordionHint1">
<div class="accordion-body">
<p>Sie können im Text suchen, indem Sie <kbd>/</kbd> drücken, und mit
<kbd>q</kbd> zur Shell zurückkehren.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Zeige mir die Lösung </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<ol start="2" style="list-style-type: decimal">
<li>Gibt die Shell-Befehle, die gerade ausgeführt werden, auf dem
Terminal aus</li>
</ol>
<p>Dies ist so nützlich, dass wir nicht wissen, warum es nicht die
Standardeinstellung ist! Die Option <code>-j1</code> sagt Snakemake,
dass es immer nur einen Prozess auf einmal ausführen soll, und wir
bleiben vorerst dabei, da es die Dinge einfacher macht. Antwort 4 ist
ein totales Ablenkungsmanöver, da Snakemake niemals interaktiv nach
Benutzereingaben fragt.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Hauptpunkte</h3>
<div class="callout-content">
<ul>
<li>“Bevor Sie Snakemake starten, müssen Sie ein Snakefile
schreiben”</li>
<li>“Ein Snakefile ist eine Textdatei, die eine Liste von Regeln
definiert”</li>
<li>“Regeln haben Eingänge, Ausgänge und Shell-Befehle, die ausgeführt
werden sollen”</li>
<li>“Du sagst Snakemake, welche Datei es erstellen soll, und es wird den
in der entsprechenden Regel definierten Shell-Befehl ausführen”</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-02-snakemake_on_the_cluster"><p>Content from <a href="02-snakemake_on_the_cluster.html">Ausführen von Snakemake auf dem Cluster</a></p>
<hr>
<p>Zuletzt aktualisiert am 2024-11-25 |

        <a href="https://github.com/carpentries-incubator/hpc-workflows/edit/main/episodes/02-snakemake_on_the_cluster.md" class="external-link">Diese Seite bearbeiten <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Geschätzte Zeit: <i aria-hidden="true" data-feather="clock"></i> 50 Minuten</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Alle Lösungen anzeigen " data-collapse="Alle Lösungen ausblenden "> Alle Lösungen anzeigen <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Übersicht</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Fragen</h3>
<ul>
<li>“Wie führe ich meine Snakemake-Regel auf dem Cluster aus?”</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Ziele</h3>
<ul>
<li>“Definieren Sie Regeln, die lokal und auf dem Cluster ausgeführt
werden”</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Was passiert, wenn wir unsere Regel auf dem Cluster und nicht auf dem
Anmeldeknoten laufen lassen wollen? Der Cluster, den wir verwenden,
benutzt Slurm, und es ist so, dass Snakemake eine eingebaute
Unterstützung für Slurm hat, wir müssen ihm nur sagen, dass wir es
benutzen wollen.</p>
<p>Snakemake verwendet die Option <code>executor</code>, um Ihnen die
Möglichkeit zu geben, das Plugin auszuwählen, mit dem Sie die Regel
ausführen möchten. Der schnellste Weg, dies auf Ihr Snakefile
anzuwenden, ist, dies auf der Kommandozeile zu definieren. Probieren wir
es aus</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">[ocaisa@node1</span> ~]$ snakemake <span class="at">-j1</span> <span class="at">-p</span> <span class="at">--executor</span> slurm hostname_login</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">AUSGABE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Building DAG of jobs...
Retrieving input from storage.
Nothing to be done (all requested files are present and up to date).</code></pre>
</div>
<p>Nichts passiert! Warum nicht? Wenn Snakemake aufgefordert wird, ein
Ziel zu erstellen, prüft es die “letzte Änderungszeit” sowohl des Ziels
als auch seiner Abhängigkeiten. Wenn eine der Abhängigkeiten seit dem
Ziel aktualisiert wurde, werden die Aktionen erneut ausgeführt, um das
Ziel zu aktualisieren. Auf diese Weise weiß Snakemake, dass es nur die
Dateien neu erstellen muss, die entweder direkt oder indirekt von der
geänderten Datei abhängen. Dies wird <em>inkrementeller Build</em>
genannt.</p>
<div id="inkrementelle-builds-verbessern-die-effizienz" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="inkrementelle-builds-verbessern-die-effizienz" class="callout-inner">
<h3 class="callout-title">Inkrementelle Builds verbessern die Effizienz</h3>
<div class="callout-content">
<p>Indem Snakemake Dateien nur bei Bedarf neu erstellt, macht es Ihre
Verarbeitung effizienter.</p>
</div>
</div>
</div>
<div id="läuft-auf-dem-cluster" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="läuft-auf-dem-cluster" class="callout-inner">
<h3 class="callout-title">Läuft auf dem Cluster</h3>
<div class="callout-content">
<p>Wir brauchen jetzt eine weitere Regel, die die <code>hostname</code>
auf dem <em>Cluster</em> ausführt. Erstellen Sie eine neue Regel in
Ihrem Snakefile und versuchen Sie, sie auf dem Cluster mit der Option
<code>--executor slurm</code> bis <code>snakemake</code>
auszuführen.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Zeige mir die Lösung </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Die Regel ist fast identisch mit der vorherigen Regel, außer dem
Namen der Regel und der Ausgabedatei:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>rule hostname_remote:</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    output: <span class="st">"hostname_remote.txt"</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    shell:</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>        <span class="co">"hostname &gt; hostname_remote.txt"</span></span></code></pre>
</div>
<p>Sie können die Regel dann ausführen mit</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">[ocaisa@node1</span> ~]$ snakemake <span class="at">-j1</span> <span class="at">-p</span> <span class="at">--executor</span> slurm hostname_remote</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">AUSGABE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Building DAG of jobs...
Retrieving input from storage.
Using shell: /cvmfs/software.eessi.io/versions/2023.06/compat/linux/x86_64/bin/bash
Provided remote nodes: 1
Job stats:
job                count
---------------  -------
hostname_remote        1
total                  1

Select jobs to execute...
Execute 1 jobs...

[Mon Jan 29 18:03:46 2024]
rule hostname_remote:
    output: hostname_remote.txt
    jobid: 0
    reason: Missing output files: hostname_remote.txt
    resources: tmpdir=&lt;TBD&gt;

hostname &gt; hostname_remote.txt
No SLURM account given, trying to guess.
Guessed SLURM account: def-users
No wall time information given. This might or might not work on your cluster.
If not, specify the resource runtime in your rule or as a reasonable default
via --default-resources. No job memory information ('mem_mb' or
'mem_mb_per_cpu') is given - submitting without.
This might or might not work on your cluster.
Job 0 has been submitted with SLURM jobid 326 (log: /home/ocaisa/.snakemake/slurm_logs/rule_hostname_remote/326.log).
[Mon Jan 29 18:04:26 2024]
Finished job 0.
1 of 1 steps (100%) done
Complete log: .snakemake/log/2024-01-29T180346.788174.snakemake.log</code></pre>
</div>
<p>Beachten Sie die Warnungen, die Snakemake ausgibt, dass die Regel
möglicherweise nicht auf unserem Cluster ausgeführt werden kann, da wir
nicht genügend Informationen angegeben haben. Zum Glück für uns
funktioniert dies auf unserem Cluster und wir können einen Blick in die
Ausgabedatei werfen, die die neue Regel erzeugt,
<code>hostname_remote.txt</code>:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">[ocaisa@node1</span> ~]$ cat hostname_remote.txt</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">AUSGABE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">tmpnode1.int.jetstream2.hpc</span><span class="op">-</span><span class="va">carpentry.org</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="snakemake-profil">Snakemake-Profil<a class="anchor" aria-label="anchor" href="#snakemake-profil"></a>
</h2>
<hr class="half-width">
<p>Das Anpassen von Snakemake an eine bestimmte Umgebung kann viele
Flags und Optionen mit sich bringen. Daher ist es möglich, ein
Konfigurationsprofil anzugeben, das verwendet wird, um Standardoptionen
zu erhalten. Das sieht dann so aus</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">snakemake</span> <span class="at">--profile</span> myprofileFolder ...</span></code></pre>
</div>
<p>Der Profilordner muss eine Datei namens <code>config.yaml</code>
enthalten, in der unsere Optionen gespeichert werden. Der Ordner kann
auch andere Dateien enthalten, die für das Profil erforderlich sind.
Erstellen wir die Datei <code>cluster_profile/config.yaml</code> und
fügen wir einige unserer bestehenden Optionen ein:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">printshellcmds</span><span class="kw">:</span><span class="at"> </span><span class="ch">True</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="fu">executor</span><span class="kw">:</span><span class="at"> slurm</span></span></code></pre>
</div>
<p>Wir sollten nun in der Lage sein, unseren Workflow erneut
auszuführen, indem wir auf das Profil verweisen, anstatt die Optionen
aufzulisten. Um die erneute Ausführung unseres Arbeitsablaufs zu
erzwingen, müssen wir zuerst die Ausgabedatei
<code>hostname_remote.txt</code> entfernen, und dann können wir unser
neues Profil ausprobieren</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">[ocaisa@node1</span> ~]$ rm hostname_remote.txt</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="ex">[ocaisa@node1</span> ~]$ snakemake <span class="at">--profile</span> cluster_profile hostname_remote</span></code></pre>
</div>
<p>Das Profil ist im Kontext unseres Clusters äußerst nützlich, da der
Slurm-Executor über viele Optionen verfügt, die man manchmal nutzen
muss, um Jobs an den Cluster zu übermitteln, auf den man Zugriff hat.
Leider sind die Namen der Optionen in Snakemake nicht <em>exakt</em>
dieselben wie die von Slurm, so dass wir die Hilfe einer
Übersetzungstabelle benötigen:</p>
<table class="table">
<colgroup>
<col width="17%">
<col width="17%">
<col width="64%">
</colgroup>
<thead><tr class="header">
<th>SLURM</th>
<th>Snakemake</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>--partition</code></td>
<td><code>slurm_partition</code></td>
<td>the partition a rule/job is to use</td>
</tr>
<tr class="even">
<td><code>--time</code></td>
<td><code>runtime</code></td>
<td>the walltime per job in minutes</td>
</tr>
<tr class="odd">
<td><code>--constraint</code></td>
<td><code>constraint</code></td>
<td>may hold features on some clusters</td>
</tr>
<tr class="even">
<td><code>--mem</code></td>
<td><code>mem, mem_mb</code></td>
<td>memory a cluster node must</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>provide (mem: string with unit), mem_mb: int</td>
</tr>
<tr class="even">
<td><code>--mem-per-cpu</code></td>
<td><code>mem_mb_per_cpu</code></td>
<td>memory per reserved CPU</td>
</tr>
<tr class="odd">
<td><code>--ntasks</code></td>
<td><code>tasks</code></td>
<td>number of concurrent tasks / ranks</td>
</tr>
<tr class="even">
<td><code>--cpus-per-task</code></td>
<td><code>cpus_per_task</code></td>
<td>number of cpus per task (in case of SMP, rather use
<code>threads</code>)</td>
</tr>
<tr class="odd">
<td><code>--nodes</code></td>
<td><code>nodes</code></td>
<td>number of nodes</td>
</tr>
</tbody>
</table>
<p>Die von Snakemake ausgegebenen Warnungen wiesen darauf hin, dass wir
diese Optionen möglicherweise bereitstellen müssen. Eine Möglichkeit,
dies zu tun, ist, sie als Teil der Snakemake-Regel mit dem Schlüsselwort
<code>resources</code> anzugeben, z.B,</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>rule:</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>    <span class="bu">input</span>: ...</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>    output: ...</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>    resources:</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>        partition: <span class="op">&lt;</span>partition name<span class="op">&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>        runtime: <span class="op">&lt;</span>some number<span class="op">&gt;</span></span></code></pre>
</div>
<p>und wir können das Profil auch verwenden, um Standardwerte für diese
Optionen zu definieren, die wir für unser Projekt verwenden, indem wir
das Schlüsselwort <code>default-resources</code> verwenden. Der
verfügbare Arbeitsspeicher unseres Clusters beträgt beispielsweise etwa
4 GB pro Kern, so dass wir dies zu unserem Profil hinzufügen können:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">printshellcmds</span><span class="kw">:</span><span class="at"> </span><span class="ch">True</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="fu">executor</span><span class="kw">:</span><span class="at"> slurm</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="fu">default-resources</span><span class="kw">:</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> mem_mb_per_cpu=3600</span></span></code></pre>
</div>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Aufgabe</h3>
<div class="callout-content">
<p>Wir wissen, dass unser Problem in einer sehr kurzen Zeit abläuft.
Ändern Sie die Standardlänge unserer Jobs auf zwei Minuten für
Slurm.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Zeige mir die Lösung </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">printshellcmds</span><span class="kw">:</span><span class="at"> </span><span class="ch">True</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="fu">executor</span><span class="kw">:</span><span class="at"> slurm</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="fu">default-resources</span><span class="kw">:</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> mem_mb_per_cpu=3600</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> runtime=2</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Es gibt verschiedene <code>sbatch</code> Optionen, die nicht direkt
von den Ressourcendefinitionen in der obigen Tabelle unterstützt werden.
Du kannst die <code>slurm_extra</code> Ressource benutzen, um jede
dieser zusätzlichen Flags für <code>sbatch</code> anzugeben:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>rule myrule:</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>    <span class="bu">input</span>: ...</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>    output: ...</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>    resources:</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>        slurm_extra<span class="op">=</span><span class="st">"--mail-type=ALL --mail-user=&lt;your email&gt;"</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="lokale-regelausführung">Lokale Regelausführung<a class="anchor" aria-label="anchor" href="#lokale-regelausf%C3%BChrung"></a>
</h2>
<hr class="half-width">
<p>Unsere ursprüngliche Regel war es, den Hostnamen des Anmeldeknotens
zu ermitteln. Wir wollen diese Regel immer auf dem Login-Knoten
ausführen, damit sie Sinn macht. Wenn wir Snakemake anweisen, alle
Regeln über den Slurm-Executor auszuführen (was wir über unser neues
Profil tun), wird dies nicht mehr geschehen. Wie können wir also
erzwingen, dass die Regel auf dem Anmeldeknoten ausgeführt wird?</p>
<p>Nun, in dem Fall, in dem eine Snakemake-Regel eine triviale Aufgabe
ausführt, könnte die Übermittlung eines Jobs ein Overkill sein (z.B.
weniger als 1 Minute Rechenzeit). Ähnlich wie in unserem Fall wäre es
eine bessere Idee, diese Regeln lokal auszuführen (d.h. dort, wo der
Befehl <code>snakemake</code> ausgeführt wird), anstatt sie als Job zu
übermitteln. In Snakemake können Sie mit dem Schlüsselwort
<code>localrules</code> angeben, welche Regeln immer lokal ausgeführt
werden sollen. Definieren wir <code>hostname_login</code> als lokale
Regel nahe dem Anfang unseres <code>Snakefile</code>.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>localrules: hostname_login</span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Hauptpunkte</h3>
<div class="callout-content">
<ul>
<li>“Snakemake generiert und übermittelt seine eigenen Batch-Skripte für
Ihren Scheduler.”</li>
<li>“Sie können Standardkonfigurationseinstellungen in einem
Snakemake-Profil speichern”</li>
<li>“<code>localrules</code> definiert Regeln, die lokal ausgeführt
werden und nie an einen Cluster übermittelt werden.”</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-03-placeholders"><p>Content from <a href="03-placeholders.html">Platzhalter</a></p>
<hr>
<p>Zuletzt aktualisiert am 2024-11-25 |

        <a href="https://github.com/carpentries-incubator/hpc-workflows/edit/main/episodes/03-placeholders.md" class="external-link">Diese Seite bearbeiten <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Geschätzte Zeit: <i aria-hidden="true" data-feather="clock"></i> 70 Minuten</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Alle Lösungen anzeigen " data-collapse="Alle Lösungen ausblenden "> Alle Lösungen anzeigen <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Übersicht</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Fragen</h3>
<ul>
<li>“Wie kann ich eine generische Regel erstellen?”</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Ziele</h3>
<ul>
<li>“Sehen Sie, wie Snakemake mit einigen Fehlern umgeht”</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Unser Snakefile hat einige Duplikate. Zum Beispiel werden die Namen
von Textdateien an einigen Stellen in den Snakefile-Regeln wiederholt.
Snakefiles sind eine Form von Code, und in jedem Code können
Wiederholungen zu Problemen führen (z.B. wenn wir eine Datendatei in
einem Teil des Snakefiles umbenennen, aber vergessen, sie an anderer
Stelle umzubenennen).</p>
<div id="d.r.y.-dont-repeat-yourself" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="d.r.y.-dont-repeat-yourself" class="callout-inner">
<h3 class="callout-title">D.R.Y. (Don’t Repeat Yourself)</h3>
<div class="callout-content">
<p>In vielen Programmiersprachen ist der Großteil der Sprachfunktionen
dazu da, dem Programmierer die Möglichkeit zu geben, langatmige
Berechnungsroutinen als kurzen, ausdrucksstarken und schönen Code zu
beschreiben. Funktionen in Python, R oder Java, wie z. B.
benutzerdefinierte Variablen und Funktionen, sind zum Teil deshalb
nützlich, weil sie bedeuten, dass wir nicht alle Details immer und immer
wieder ausschreiben (oder darüber nachdenken) müssen. Diese gute
Angewohnheit, Dinge nur einmal auszuschreiben, ist bekannt als das
“Don’t Repeat Yourself”-Prinzip oder D.R.Y.</p>
</div>
</div>
</div>
<p>Machen wir uns daran, einige der Wiederholungen aus unserem Snakefile
zu entfernen.</p>
<section><h2 class="section-heading" id="platzhalter">Platzhalter<a class="anchor" aria-label="anchor" href="#platzhalter"></a>
</h2>
<hr class="half-width">
<p>Um eine allgemeinere Regel zu erstellen, brauchen wir
<strong>Platzhalter</strong>. Schauen wir uns mal an, wie ein
Platzhalter aussieht</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>rule hostname_remote:</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>    output: <span class="st">"hostname_remote.txt"</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    shell:</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>        <span class="co">"hostname &gt; {output}"</span></span></code></pre>
</div>
<p>Zur Erinnerung, hier ist die vorherige Version aus der letzten
Folge:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>rule hostname_remote:</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    output: <span class="st">"hostname_remote.txt"</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    shell:</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>        <span class="co">"hostname &gt; hostname_remote.txt"</span></span></code></pre>
</div>
<p>Die neue Regel hat explizite Dateinamen durch Dinge in
<code>{curly brackets}</code> ersetzt, speziell <code>{output}</code>
(aber es hätte auch <code>{input}</code> sein können…wenn das einen Wert
hätte und nützlich wäre).</p>
<div class="section level3">
<h3 id="input-und-output-sind-platzhalter">
<code>{input}</code> und <code>{output}</code> sind
<strong>Platzhalter</strong>
<a class="anchor" aria-label="anchor" href="#input-und-output-sind-platzhalter"></a>
</h3>
<p>Platzhalter werden im Abschnitt <code>shell</code> einer Regel
verwendet, und Snakemake ersetzt sie durch entsprechende Werte -
<code>{input}</code> durch den vollständigen Namen der Eingabedatei und
<code>{output}</code> durch den vollständigen Namen der Ausgabedatei –
bevor der Befehl ausgeführt wird.</p>
<p><code>{resources}</code> ist auch ein Platzhalter, und wir können auf
ein benanntes Element des <code>{resources}</code> mit der Notation
<code>{resources.runtime}</code> zugreifen (zum Beispiel).</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Hauptpunkte</h3>
<div class="callout-content">
<ul>
<li>“Snakemake-Regeln werden mit Platzhaltern generischer
gestaltet”</li>
<li>“Platzhalter im Shell-Teil der Regel werden durch Werte ersetzt, die
auf den gewählten Platzhaltern basieren”</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-04-snakemake_and_mpi"><p>Content from <a href="04-snakemake_and_mpi.html">MPI-Anwendungen und Snakemake</a></p>
<hr>
<p>Zuletzt aktualisiert am 2024-11-25 |

        <a href="https://github.com/carpentries-incubator/hpc-workflows/edit/main/episodes/04-snakemake_and_mpi.md" class="external-link">Diese Seite bearbeiten <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Geschätzte Zeit: <i aria-hidden="true" data-feather="clock"></i> 50 Minuten</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Alle Lösungen anzeigen " data-collapse="Alle Lösungen ausblenden "> Alle Lösungen anzeigen <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Übersicht</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Fragen</h3>
<ul>
<li>“Wie kann ich eine MPI-Anwendung über Snakemake auf dem Cluster
ausführen?”</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Ziele</h3>
<ul>
<li>“Definiere Regeln, die lokal und im Cluster laufen sollen”</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Jetzt ist es an der Zeit, sich wieder unserem eigentlichen
Arbeitsablauf zuzuwenden. Wir können einen Befehl auf dem Cluster
ausführen, aber was ist mit der Ausführung der MPI-Anwendung, an der wir
interessiert sind? Unsere Anwendung heißt <code>amdahl</code> und ist
als Umgebungsmodul verfügbar.</p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Aufgabe</h3>
<div class="callout-content">
<p>Suchen und laden Sie das Modul <code>amdahl</code> und
<em>ersetzen</em> Sie dann unsere <code>hostname_remote</code>-Regel
durch eine Version, die <code>amdahl</code> ausführt. (Machen Sie sich
noch keine Gedanken über paralleles MPI, lassen Sie es mit einer
einzelnen CPU laufen, <code>mpiexec -n 1 amdahl</code>).</p>
<p>Wird Ihre Regel korrekt ausgeführt? Wenn nicht, sehen Sie sich die
Protokolldateien an, um herauszufinden, warum?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Zeige mir die Lösung </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">module</span> spider amdahl</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">module</span> load amdahl</span></code></pre>
</div>
<p>findet das Modul <code>amdahl</code> und lädt es dann. Wir können
dann unsere Regel aktualisieren/ersetzen, um die Anwendung
<code>amdahl</code> auszuführen:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>rule amdahl_run:</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    output: <span class="st">"amdahl_run.txt"</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    shell:</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>        <span class="co">"mpiexec -n 1 amdahl &gt; {output}"</span></span></code></pre>
</div>
<p>Wenn wir jedoch versuchen, die Regel auszuführen, erhalten wir eine
Fehlermeldung (es sei denn, Sie haben bereits eine andere Version von
<code>amdahl</code> in Ihrem Pfad verfügbar). Snakemake meldet den
Speicherort der Protokolle und wenn wir darin nachsehen, finden wir
(eventuell)</p>
<div class="codewrapper">
<h3 class="code-label">AUSGABE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>...
mpiexec -n 1 amdahl &gt; amdahl_run.txt
--------------------------------------------------------------------------
mpiexec was unable to find the specified executable file, and therefore
did not launch the job.  This error was first reported for process
rank 0; it may have occurred for other processes as well.

NOTE: A common cause for this error is misspelling a mpiexec command
      line parameter option (remember that mpiexec interprets the first
      unrecognized command line token as the executable).

Node:       tmpnode1
Executable: amdahl
--------------------------------------------------------------------------
...</code></pre>
</div>
<p>Obwohl wir das Modul vor der Ausführung des Workflows geladen haben,
hat unsere Snakemake-Regel die ausführbare Datei nicht gefunden. Das
liegt daran, dass die Snakemake-Regel in einer sauberen
<em>Laufzeitumgebung</em> läuft, und wir müssen ihr irgendwie sagen,
dass sie das notwendige Umgebungsmodul laden soll, bevor wir versuchen,
die Regel auszuführen.</p>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="snakemake-und-umgebungsmodule">Snakemake und Umgebungsmodule<a class="anchor" aria-label="anchor" href="#snakemake-und-umgebungsmodule"></a>
</h2>
<hr class="half-width">
<p>Unsere Anwendung heißt <code>amdahl</code> und ist auf dem System
über ein Umgebungsmodul verfügbar, also müssen wir Snakemake sagen, dass
es das Modul laden soll, bevor es versucht, die Regel auszuführen.
Snakemake kennt Umgebungsmodule, und diese können über eine (weitere)
Option angegeben werden:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>rule amdahl_run:</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    output: <span class="st">"amdahl_run.txt"</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    envmodules:</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>      <span class="co">"mpi4py"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>      <span class="co">"amdahl"</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    shell:</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>        <span class="co">"mpiexec -n 1 amdahl &gt; {output}"</span></span></code></pre>
</div>
<p>Das Hinzufügen dieser Zeilen reicht jedoch nicht aus, damit die Regel
ausgeführt wird. Sie müssen Snakemake nicht nur mitteilen, welche Module
geladen werden sollen, sondern auch, dass es generell Umgebungsmodule
verwenden soll (da die Verwendung von Umgebungsmodulen Ihre
Laufzeitumgebung weniger reproduzierbar macht, da sich die verfügbaren
Module von Cluster zu Cluster unterscheiden können). Dazu müssen Sie
Snakemake eine zusätzliche Option geben</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">snakemake</span> <span class="at">--profile</span> cluster_profile <span class="at">--use-envmodules</span> amdahl_run</span></code></pre>
</div>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Aufgabe</h3>
<div class="callout-content">
<p>Wir werden im weiteren Verlauf des Tutorials Umgebungsmodule
verwenden, also machen Sie dies zu einer Standardoption unseres Profils
(indem Sie den Wert auf <code>True</code> setzen)</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Zeige mir die Lösung </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>Aktualisiere unser Clusterprofil auf</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">printshellcmds</span><span class="kw">:</span><span class="at"> </span><span class="ch">True</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="fu">executor</span><span class="kw">:</span><span class="at"> slurm</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="fu">default-resources</span><span class="kw">:</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> mem_mb_per_cpu=3600</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> runtime=2</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="fu">use-envmodules</span><span class="kw">:</span><span class="at"> </span><span class="ch">True</span></span></code></pre>
</div>
<p>Wenn Sie es testen wollen, müssen Sie die Ausgabedatei der Regel
löschen und Snakemake erneut ausführen.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="snakemake-und-mpi">Snakemake und MPI<a class="anchor" aria-label="anchor" href="#snakemake-und-mpi"></a>
</h2>
<hr class="half-width">
<p>Im letzten Abschnitt haben wir nicht wirklich eine MPI-Anwendung
ausgeführt, da wir nur auf einem Kern gearbeitet haben. Wie können wir
für eine einzelne Regel die Ausführung auf mehreren Kernen
anfordern?</p>
<p>Snakemake bietet allgemeine Unterstützung für MPI, aber der einzige
Executor, der MPI derzeit explizit unterstützt, ist der Slurm-Executor
(ein Glück für uns!). Wenn wir uns unsere Übersetzungstabelle von Slurm
nach Snakemake ansehen, stellen wir fest, dass die relevanten Optionen
in der Nähe des unteren Randes erscheinen:</p>
<table class="table">
<colgroup>
<col width="18%">
<col width="15%">
<col width="65%">
</colgroup>
<thead><tr class="header">
<th>SLURM</th>
<th>Snakemake</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="even">
<td><code>--ntasks</code></td>
<td><code>tasks</code></td>
<td>number of concurrent tasks / ranks</td>
</tr>
<tr class="odd">
<td><code>--cpus-per-task</code></td>
<td><code>cpus_per_task</code></td>
<td>number of cpus per task (in case of SMP, rather use
<code>threads</code>)</td>
</tr>
<tr class="even">
<td><code>--nodes</code></td>
<td><code>nodes</code></td>
<td>number of nodes</td>
</tr>
</tbody>
</table>
<p>Diejenige, die uns interessiert, ist <code>tasks</code>, da wir nur
die Anzahl der Ränge erhöhen wollen. Wir können diese in einem
<code>resources</code>-Abschnitt unserer Regel definieren und mit
Platzhaltern auf sie verweisen:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>rule amdahl_run:</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    output: <span class="st">"amdahl_run.txt"</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    envmodules:</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>      <span class="co">"amdahl"</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    resources:</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>      mpi<span class="op">=</span><span class="st">'mpiexec'</span>,</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>      tasks<span class="op">=</span><span class="dv">2</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    shell:</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>        <span class="co">"{resources.mpi} -n {resources.tasks} amdahl &gt; {output}"</span></span></code></pre>
</div>
<p>Das hat funktioniert, aber jetzt haben wir ein kleines Problem. Wir
möchten dies für einige verschiedene Werte von <code>tasks</code> tun,
was bedeuten würde, dass wir für jeden Lauf eine andere Ausgabedatei
benötigen. Es wäre großartig, wenn wir irgendwie in <code>output</code>
den Wert angeben könnten, den wir für <code>tasks</code> verwenden
wollen… und Snakemake das übernehmen könnte.</p>
<p>Wir könnten eine <em>Wildcard</em> in der <code>output</code>
verwenden, um die <code>tasks</code> zu definieren, die wir verwenden
wollen. Die Syntax für einen solchen Platzhalter sieht wie folgt aus</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>output: <span class="st">"amdahl_run_</span><span class="sc">{parallel_tasks}</span><span class="st">.txt"</span></span></code></pre>
</div>
<p>wobei <code>parallel_tasks</code> unser Platzhalter ist.</p>
<div id="wildcards" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="wildcards" class="callout-inner">
<h3 class="callout-title">Wildcards</h3>
<div class="callout-content">
<p>Wildcards werden in den Zeilen <code>input</code> und
<code>output</code> der Regel verwendet, um Teile von Dateinamen zu
repräsentieren. Ähnlich wie das <code>*</code>-Muster in der Shell, kann
der Platzhalter für jeden beliebigen Text stehen, um den gewünschten
Dateinamen zu bilden. Wie bei der Benennung Ihrer Regeln können Sie auch
für Ihre Platzhalter einen beliebigen Namen wählen, hier also
<code>parallel_tasks</code>. Durch die Verwendung der gleichen
Platzhalter in der Eingabe und der Ausgabe wird Snakemake mitgeteilt,
wie die Eingabedateien den Ausgabedateien zugeordnet werden sollen.</p>
<p>Wenn zwei Regeln einen Platzhalter mit demselben Namen verwenden,
behandelt Snakemake sie als unterschiedliche Einheiten - Regeln in
Snakemake sind auf diese Weise in sich geschlossen.</p>
<p>In der Zeile <code>shell</code> kann man den Platzhalter mit
<code>{wildcards.parallel_tasks}</code> referenzieren</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="snakemake-reihenfolge-der-operationen">Snakemake Reihenfolge der Operationen<a class="anchor" aria-label="anchor" href="#snakemake-reihenfolge-der-operationen"></a>
</h2>
<hr class="half-width">
<p>Wir fangen gerade erst mit ein paar einfachen Regeln an, aber es
lohnt sich, darüber nachzudenken, was Snakemake genau macht, wenn Sie es
ausführen. Es gibt drei verschiedene Phasen:</p>
<ol style="list-style-type: decimal">
<li>Bereitet sich auf die Ausführung vor:
<ol style="list-style-type: decimal">
<li>Liest alle Regeldefinitionen aus dem Snakefile ein</li>
</ol>
</li>
<li>Planen, was zu tun ist:
<ol style="list-style-type: decimal">
<li>Zeigt an, welche Datei(en) Sie erstellen lassen wollen</li>
<li>Sucht nach einer passenden Regel, indem es die <code>output</code>
aller ihm bekannten Regeln betrachtet</li>
<li>Füllt die Platzhalter aus, um die <code>input</code> für diese Regel
zu berechnen</li>
<li>Prüft, ob diese Eingabedatei (falls erforderlich) tatsächlich
vorhanden ist</li>
</ol>
</li>
<li>Führt die Schritte aus:
<ol style="list-style-type: decimal">
<li>Erzeugt das Verzeichnis für die Ausgabedatei, falls
erforderlich</li>
<li>Entfernt die alte Ausgabedatei, wenn sie bereits vorhanden ist</li>
<li>Nur dann wird der Shell-Befehl mit den ersetzten Platzhaltern
ausgeführt</li>
<li>Prüft, ob der Befehl ohne Fehler ausgeführt <em>und</em> die neue
Ausgabedatei wie erwartet erstellt wurde</li>
</ol>
</li>
</ol>
<div id="trockenlauf--n-modus" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="trockenlauf--n-modus" class="callout-inner">
<h3 class="callout-title">Trockenlauf (<code>-n</code>) Modus</h3>
<div class="callout-content">
<p>Es ist oft nützlich, nur die ersten beiden Phasen laufen zu lassen,
so dass Snakemake die auszuführenden Jobs plant und sie auf dem
Bildschirm ausgibt, sie aber nie tatsächlich ausführt. Dies wird mit dem
<code>-n</code> Flag erreicht, z.B.:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="op">&gt;</span> $ <span class="ex">snakemake</span> <span class="at">-n</span> ...</span></code></pre>
</div>
</div>
</div>
</div>
<p>Die Anzahl der Überprüfungen mag im Moment noch pedantisch
erscheinen, aber wenn der Arbeitsablauf mehr Schritte umfasst, wird dies
in der Tat sehr nützlich für uns werden.</p>
</section><section><h2 class="section-heading" id="verwendung-von-wildcards-in-unserer-regel">Verwendung von Wildcards in unserer Regel<a class="anchor" aria-label="anchor" href="#verwendung-von-wildcards-in-unserer-regel"></a>
</h2>
<hr class="half-width">
<p>Wir möchten einen Platzhalter in <code>output</code> verwenden, um
die Anzahl der <code>tasks</code> zu definieren, die wir verwenden
möchten. Ausgehend von dem, was wir bisher gesehen haben, könnten Sie
sich vorstellen, dass dies wie folgt aussehen könnte</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>rule amdahl_run:</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>    output: <span class="st">"amdahl_run_</span><span class="sc">{parallel_tasks}</span><span class="st">.txt"</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>    envmodules:</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>      <span class="co">"amdahl"</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>    resources:</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>      mpi<span class="op">=</span><span class="st">"mpiexec"</span>,</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>      tasks<span class="op">=</span><span class="st">"</span><span class="sc">{parallel_tasks}</span><span class="st">"</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>    shell:</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>        <span class="co">"{resources.mpi} -n {resources.tasks} amdahl &gt; {output}"</span></span></code></pre>
</div>
<p>aber es gibt zwei Probleme damit:</p>
<ul>
<li>Die einzige Möglichkeit für Snakemake, den Wert des Platzhalters zu
erfahren, besteht darin, dass der Benutzer explizit eine konkrete
Ausgabedatei anfordert (anstatt die Regel aufzurufen):</li>
</ul>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>  <span class="ex">snakemake</span> <span class="at">--profile</span> cluster_profile amdahl_run_2.txt</span></code></pre>
</div>
<p>Dies ist vollkommen gültig, da Snakemake herausfinden kann, dass es
eine Regel gibt, die mit diesem Dateinamen übereinstimmen kann.</p>
<ul>
<li>
<p>Das größere Problem ist, dass selbst das nicht funktioniert, es
scheint, dass wir keinen Platzhalter für <code>tasks</code> verwenden
können:</p>
<div class="codewrapper">
<h3 class="code-label">AUSGABE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>WorkflowError:
SLURM job submission failed. The error message was sbatch:
error: Invalid numeric value "{parallel_tasks}" for --ntasks.</code></pre>
</div>
</li>
</ul>
<p>Leider gibt es für uns keine direkte Möglichkeit, auf die Platzhalter
für <code>tasks</code> zuzugreifen. Der Grund dafür ist, dass Snakemake
versucht, den Wert von <code>tasks</code> während seiner
Initialisierungsphase zu verwenden, also bevor wir den Wert des
Platzhalters kennen. Wir müssen die Bestimmung von <code>tasks</code>
auf einen späteren Zeitpunkt verschieben. Dies kann erreicht werden,
indem für dieses Szenario eine Eingabefunktion anstelle eines Wertes
angegeben wird. Die Lösung besteht also darin, eine einmalig zu
verwendende Funktion zu schreiben, die Snakemake dazu bringt, dies für
uns zu tun. Da die Funktion speziell für die Regel gedacht ist, können
wir eine einzeilige Funktion ohne Namen verwenden. Diese Art von
Funktionen werden entweder anonyme Funktionen oder Lamdba-Funktionen
genannt (beide bedeuten dasselbe) und sind ein Merkmal von Python (und
anderen Programmiersprachen).</p>
<p>Um eine Lambda-Funktion in Python zu definieren, ist die allgemeine
Syntax wie folgt:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="kw">lambda</span> x: x <span class="op">+</span> <span class="dv">54</span></span></code></pre>
</div>
<p>Da unsere Funktion die Wildcards als Argumente annehmen kann, können
wir damit den Wert für <code>tasks</code> festlegen:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>rule amdahl_run:</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>    output: <span class="st">"amdahl_run_</span><span class="sc">{parallel_tasks}</span><span class="st">.txt"</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>    envmodules:</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>      <span class="co">"amdahl"</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>    resources:</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>      mpi<span class="op">=</span><span class="st">"mpiexec"</span>,</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>      <span class="co"># No direct way to access the wildcard in tasks, so we need to do this</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>      <span class="co"># indirectly by declaring a short function that takes the wildcards as an</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>      <span class="co"># argument</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>      tasks<span class="op">=</span><span class="kw">lambda</span> wildcards: <span class="bu">int</span>(wildcards.parallel_tasks)</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>    shell:</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>        <span class="co">"{resources.mpi} -n {resources.tasks} amdahl &gt; {output}"</span></span></code></pre>
</div>
<p>Jetzt haben wir eine Regel, die verwendet werden kann, um die Ausgabe
von Läufen einer beliebigen Anzahl von parallelen Aufgaben zu
erzeugen.</p>
<div id="kommentare-in-snakefiles" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="kommentare-in-snakefiles" class="callout-inner">
<h3 class="callout-title">Kommentare in Snakefiles</h3>
<div class="callout-content">
<p>Im obigen Code ist die Zeile, die mit <code>#</code> beginnt, eine
Kommentarzeile. Hoffentlich haben Sie sich bereits angewöhnt, Kommentare
in Ihre eigenen Skripte einzufügen. Gute Kommentare machen jedes Skript
besser lesbar, und das gilt auch für Snakefiles.</p>
</div>
</div>
</div>
<p>Da unsere Regel nun in der Lage ist, eine beliebige Anzahl von
Ausgabedateien zu erzeugen, könnte es in unserem aktuellen Verzeichnis
sehr voll werden. Es ist daher wahrscheinlich am besten, die Läufe in
einen separaten Ordner zu legen, um Ordnung zu schaffen. Wir können den
Ordner direkt zu unserem <code>output</code> hinzufügen und Snakemake
wird die Erstellung des Verzeichnisses für uns übernehmen:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>rule amdahl_run:</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>    output: <span class="st">"runs/amdahl_run_</span><span class="sc">{parallel_tasks}</span><span class="st">.txt"</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>    envmodules:</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>      <span class="co">"amdahl"</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>    resources:</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>      mpi<span class="op">=</span><span class="st">"mpiexec"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>      <span class="co"># No direct way to access the wildcard in tasks, so we need to do this</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>      <span class="co"># indirectly by declaring a short function that takes the wildcards as an</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>      <span class="co"># argument</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>      tasks<span class="op">=</span><span class="kw">lambda</span> wildcards: <span class="bu">int</span>(wildcards.parallel_tasks)</span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>    shell:</span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>        <span class="co">"{resources.mpi} -n {resources.tasks} amdahl &gt; {output}"</span></span></code></pre>
</div>
<div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Aufgabe</h3>
<div class="callout-content">
<p>Erstellt eine Ausgabedatei (im Ordner <code>runs</code>) für den
Fall, dass wir 6 parallele Aufgaben haben</p>
<p>(TIPP: Denken Sie daran, dass Snakemake in der Lage sein muss, die
angeforderte Datei mit dem <code>output</code> einer Regel
abzugleichen)</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Zeige mir die Lösung </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">snakemake</span> <span class="at">--profile</span> cluster_profile runs/amdahl_run_6.txt</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Ein weiterer Punkt bei unserer Anwendung <code>amdahl</code> ist,
dass wir die Ausgabe schließlich verarbeiten wollen, um unsere
Skalierungsdarstellung zu erzeugen. Die derzeitige Ausgabe ist zwar
nützlich zum Lesen, erschwert aber die Verarbeitung. <code>amdahl</code>
hat eine Option, die dies für uns einfacher macht. Um die
<code>amdahl</code>-Optionen zu sehen, können wir verwenden</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">[ocaisa@node1</span> ~]$ module load amdahl</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="ex">[ocaisa@node1</span> ~]$ amdahl <span class="at">--help</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">AUSGABE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>usage: amdahl [-h] [-p [PARALLEL_PROPORTION]] [-w [WORK_SECONDS]] [-t] [-e]

options:
  -h, --help            show this help message and exit
  -p [PARALLEL_PROPORTION], --parallel-proportion [PARALLEL_PROPORTION]
                        Parallel proportion should be a float between 0 and 1
  -w [WORK_SECONDS], --work-seconds [WORK_SECONDS]
                        Total seconds of workload, should be an integer greater than 0
  -t, --terse           Enable terse output
  -e, --exact           Disable random jitter</code></pre>
</div>
<p>Die Option, nach der wir suchen, ist <code>--terse</code>, und die
bewirkt, dass <code>amdahl</code> in einem viel einfacher zu
verarbeitenden Format ausgegeben wird, nämlich JSON. Das JSON-Format in
einer Datei verwendet normalerweise die Dateierweiterung
<code>.json</code>, also fügen wir diese Option zu unserem
<code>shell</code>-Befehl hinzu <em>und</em> ändern das Dateiformat von
<code>output</code>, damit es zu unserem neuen Befehl passt:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>rule amdahl_run:</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>    output: <span class="st">"runs/amdahl_run_</span><span class="sc">{parallel_tasks}</span><span class="st">.json"</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>    envmodules:</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>      <span class="co">"amdahl"</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>    resources:</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>      mpi<span class="op">=</span><span class="st">"mpiexec"</span>,</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>      <span class="co"># No direct way to access the wildcard in tasks, so we need to do this</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>      <span class="co"># indirectly by declaring a short function that takes the wildcards as an</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>      <span class="co"># argument</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>      tasks<span class="op">=</span><span class="kw">lambda</span> wildcards: <span class="bu">int</span>(wildcards.parallel_tasks)</span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>    shell:</span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>        <span class="co">"{resources.mpi} -n {resources.tasks} amdahl --terse &gt; {output}"</span></span></code></pre>
</div>
<p>Es gab einen weiteren Parameter für <code>amdahl</code>, der mir
aufgefallen ist. <code>amdahl</code> hat eine Option
<code>--parallel-proportion</code> (oder <code>-p</code>), an deren
Änderung wir interessiert sein könnten, da sie das Verhalten des Codes
verändert und sich somit auf die Werte auswirkt, die wir in unseren
Ergebnissen erhalten. Fügen wir eine weitere Verzeichnisebene zu unserem
Ausgabeformat hinzu, um eine bestimmte Wahl für diesen Wert
wiederzugeben. Wir können einen Platzhalter verwenden, damit wir den
Wert gleich auswählen müssen:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>rule amdahl_run:</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>    output: <span class="st">"p_</span><span class="sc">{parallel_proportion}</span><span class="st">/runs/amdahl_run_</span><span class="sc">{parallel_tasks}</span><span class="st">.json"</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>    envmodules:</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>      <span class="co">"amdahl"</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>    resources:</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>      mpi<span class="op">=</span><span class="st">"mpiexec"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>      <span class="co"># No direct way to access the wildcard in tasks, so we need to do this</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>      <span class="co"># indirectly by declaring a short function that takes the wildcards as an</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>      <span class="co"># argument</span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>      tasks<span class="op">=</span><span class="kw">lambda</span> wildcards: <span class="bu">int</span>(wildcards.parallel_tasks)</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a>    shell:</span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a>        <span class="co">"{resources.mpi} -n {resources.tasks} amdahl --terse -p {wildcards.parallel_proportion} &gt; {output}"</span></span></code></pre>
</div>
<div id="challenge4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Aufgabe</h3>
<div class="callout-content">
<p>Erstellen Sie eine Ausgabedatei für einen Wert von <code>-p</code>
von 0,999 (der Standardwert ist 0,8) für den Fall, dass wir 6 parallele
Aufgaben haben.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Zeige mir die Lösung </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="ex">snakemake</span> <span class="at">--profile</span> cluster_profile p_0.999/runs/amdahl_run_6.json</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Hauptpunkte</h3>
<div class="callout-content">
<ul>
<li>“Snakemake wählt die passende Regel durch Ersetzen von Platzhaltern
aus, so dass die Ausgabe mit dem Ziel übereinstimmt”</li>
<li>“Snakemake prüft auf verschiedene Fehlerzustände und hält an, wenn
es ein Problem sieht”</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-05-chaining_rules"><p>Content from <a href="05-chaining_rules.html">Verkettung von Regeln</a></p>
<hr>
<p>Zuletzt aktualisiert am 2024-11-25 |

        <a href="https://github.com/carpentries-incubator/hpc-workflows/edit/main/episodes/05-chaining_rules.md" class="external-link">Diese Seite bearbeiten <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Geschätzte Zeit: <i aria-hidden="true" data-feather="clock"></i> 70 Minuten</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Alle Lösungen anzeigen " data-collapse="Alle Lösungen ausblenden "> Alle Lösungen anzeigen <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Übersicht</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Fragen</h3>
<ul>
<li>“Wie kombiniere ich Regeln zu einem Workflow?”</li>
<li>“Wie erstelle ich eine Regel mit mehreren Eingaben und
Ausgaben?”</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Ziele</h3>
<ul>
<li>“”</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="eine-pipeline-mit-mehreren-regeln">Eine Pipeline mit mehreren Regeln<a class="anchor" aria-label="anchor" href="#eine-pipeline-mit-mehreren-regeln"></a>
</h2>
<hr class="half-width">
<p>Wir haben jetzt eine Regel, die eine Ausgabe für jeden Wert von
<code>-p</code> und eine beliebige Anzahl von Aufgaben erzeugen kann,
wir müssen Snakemake nur mit den gewünschten Parametern aufrufen:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">snakemake</span> <span class="at">--profile</span> cluster_profile p_0.999/runs/amdahl_run_6.json</span></code></pre>
</div>
<p>Das ist allerdings nicht gerade praktisch, denn um einen
vollständigen Datensatz zu erzeugen, müssen wir Snakemake viele Male mit
verschiedenen Ausgabedateien ausführen. Lassen Sie uns stattdessen eine
Regel erstellen, die diese Dateien für uns generieren kann.</p>
<p>Die Verkettung von Regeln in Snakemake ist eine Frage der Wahl von
Dateinamensmustern, die die Regeln verbinden. Das ist eine Kunst für
sich - meistens gibt es mehrere Möglichkeiten, die funktionieren:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>rule generate_run_files:</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    output: <span class="st">"p_</span><span class="sc">{parallel_proportion}</span><span class="st">_runs.txt"</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    <span class="bu">input</span>:  <span class="st">"p_</span><span class="sc">{parallel_proportion}</span><span class="st">/runs/amdahl_run_6.json"</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    shell:</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>        <span class="co">"echo {input} done &gt; {output}"</span></span></code></pre>
</div>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Aufgabe</h3>
<div class="callout-content">
<p>Die neue Regel macht keine Arbeit, sie stellt nur sicher, dass wir
die gewünschte Datei erzeugen. Sie ist es nicht wert, auf dem Cluster
ausgeführt zu werden. Wie kann man sicherstellen, dass sie nur auf dem
Anmeldeknoten ausgeführt wird?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Zeige mir die Lösung </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Wir müssen die neue Regel zu unserer <code>localrules</code>
hinzufügen:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>localrules: hostname_login, generate_run_files</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Führen wir nun die neue Regel aus (denken Sie daran, dass wir die
Ausgabedatei mit dem Namen anfordern müssen, da das <code>output</code>
in unserer Regel ein Platzhaltermuster enthält):</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">[ocaisa@node1</span> ~]$ snakemake <span class="at">--profile</span> cluster_profile/ p_0.999_runs.txt</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">AUSGABE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Using profile cluster_profile/ for setting default command line arguments.
Building DAG of jobs...
Retrieving input from storage.
Using shell: /cvmfs/software.eessi.io/versions/2023.06/compat/linux/x86_64/bin/bash
Provided remote nodes: 3
Job stats:
job                   count
------------------  -------
amdahl_run                1
generate_run_files        1
total                     2

Select jobs to execute...
Execute 1 jobs...

[Tue Jan 30 17:39:29 2024]
rule amdahl_run:
    output: p_0.999/runs/amdahl_run_6.json
    jobid: 1
    reason: Missing output files: p_0.999/runs/amdahl_run_6.json
    wildcards: parallel_proportion=0.999, parallel_tasks=6
    resources: mem_mb=1000, mem_mib=954, disk_mb=1000, disk_mib=954,
               tmpdir=&lt;TBD&gt;, mem_mb_per_cpu=3600, runtime=2, mpi=mpiexec, tasks=6

mpiexec -n 6 amdahl --terse -p 0.999 &gt; p_0.999/runs/amdahl_run_6.json
No SLURM account given, trying to guess.
Guessed SLURM account: def-users
Job 1 has been submitted with SLURM jobid 342 (log: /home/ocaisa/.snakemake/slurm_logs/rule_amdahl_run/342.log).
[Tue Jan 30 17:47:31 2024]
Finished job 1.
1 of 2 steps (50%) done
Select jobs to execute...
Execute 1 jobs...

[Tue Jan 30 17:47:31 2024]
localrule generate_run_files:
    input: p_0.999/runs/amdahl_run_6.json
    output: p_0.999_runs.txt
    jobid: 0
    reason: Missing output files: p_0.999_runs.txt;
            Input files updated by another job: p_0.999/runs/amdahl_run_6.json
    wildcards: parallel_proportion=0.999
    resources: mem_mb=1000, mem_mib=954, disk_mb=1000, disk_mib=954,
               tmpdir=/tmp, mem_mb_per_cpu=3600, runtime=2

echo p_0.999/runs/amdahl_run_6.json done &gt; p_0.999_runs.txt
[Tue Jan 30 17:47:31 2024]
Finished job 0.
2 of 2 steps (100%) done
Complete log: .snakemake/log/2024-01-30T173929.781106.snakemake.log</code></pre>
</div>
<p>Schauen Sie sich die Logging-Meldungen an, die Snakemake im Terminal
ausgibt. Was ist hier passiert?</p>
<ol style="list-style-type: decimal">
<li>Snakemake sucht nach einer Regel, die <code>p_0.999_runs.txt</code>
erzeugt</li>
<li>Es bestimmt, dass “generate_run_files” dies machen kann, wenn
<code>parallel_proportion=0.999</code>
</li>
<li>Es sieht, dass die benötigte Eingabe also
<code>p_0.999/runs/amdahl_run_6.json</code> ist</li>
<li>Snakemake sucht nach einer Regel, die
<code>p_0.999/runs/amdahl_run_6.json</code> erzeugt</li>
<li>Es wird festgestellt, dass “amdahl_run” dies machen kann, wenn
<code>parallel_proportion=0.999</code> und
<code>parallel_tasks=6</code>
</li>
<li>Nachdem Snakemake eine verfügbare Eingabedatei erreicht hat (in
diesem Fall ist eigentlich keine Eingabedatei erforderlich), führt es
beide Schritte aus, um die endgültige Ausgabe zu erhalten</li>
</ol>
<p>Dies ist, kurz gesagt, wie wir Arbeitsabläufe in Snakemake
aufbauen.</p>
<ol style="list-style-type: decimal">
<li>Definieren Sie Regeln für alle Verarbeitungsschritte</li>
<li>Wählen Sie <code>input</code> und <code>output</code> Namensmuster,
die es Snakemake erlauben, die Regeln zu verknüpfen</li>
<li>Sagt Snakemake, dass es die endgültige(n) Ausgabedatei(en) erzeugen
soll</li>
</ol>
<p>Wenn Sie es gewohnt sind, reguläre Skripte zu schreiben, ist dies ein
wenig gewöhnungsbedürftig. Anstatt die Schritte in der Reihenfolge ihrer
Ausführung aufzulisten, arbeiten Sie immer <strong>rückwärts</strong>
vom gewünschten Endergebnis aus. Die Reihenfolge der Operationen wird
durch die Anwendung der Mustervergleichsregeln auf die Dateinamen
bestimmt, nicht durch die Reihenfolge der Regeln in der Snakefile.</p>
<div id="outputs-first" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="outputs-first" class="callout-inner">
<h3 class="callout-title">Outputs first?</h3>
<div class="callout-content">
<p>Der Ansatz von Snakemake, von der gewünschten Ausgabe rückwärts zu
arbeiten, um den Arbeitsablauf zu bestimmen, ist der Grund, warum wir
die <code>output</code>-Zeilen an den Anfang aller unserer Regeln
stellen - um uns daran zu erinnern, dass dies die Zeilen sind, auf die
Snakemake zuerst schaut!</p>
<p>Viele Benutzer von Snakemake, und auch die offizielle Dokumentation,
bevorzugen es, die <code>input</code> an erster Stelle zu haben, also
sollten Sie in der Praxis die Reihenfolge verwenden, die für Sie
sinnvoll ist.</p>
</div>
</div>
</div>
<div id="log-ausgaben-in-snakemake" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="log-ausgaben-in-snakemake" class="callout-inner">
<h3 class="callout-title">
<code>log</code> Ausgaben in Snakemake</h3>
<div class="callout-content">
<p>Snakemake hat ein eigenes Regelfeld für Ausgaben, die [Logdateien]
(<a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html#log-files" class="external-link uri">https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html#log-files</a>)
sind, und diese werden größtenteils wie reguläre Ausgaben behandelt,
außer dass Logdateien nicht entfernt werden, wenn der Job einen Fehler
produziert. Das bedeutet, dass Sie sich das Protokoll ansehen können, um
den Fehler zu diagnostizieren. In einem echten Arbeitsablauf kann dies
sehr nützlich sein, aber um die Grundlagen von Snakemake zu erlernen,
bleiben wir hier bei regulären <code>input</code> und
<code>output</code> Feldern.</p>
</div>
</div>
</div>
<div id="fehler-sind-normal" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="fehler-sind-normal" class="callout-inner">
<h3 class="callout-title">Fehler sind normal</h3>
<div class="callout-content">
<p>Lassen Sie sich nicht entmutigen, wenn Sie beim ersten Testen Ihrer
neuen Snakemake-Pipelines Fehler sehen. Beim Schreiben eines neuen
Arbeitsablaufs kann eine Menge schief gehen, und Sie werden
normalerweise mehrere Iterationen benötigen, um alles richtig zu machen.
Ein Vorteil des Snakemake-Ansatzes im Vergleich zu normalen Skripten
ist, dass Snakemake bei Problemen schnell abbricht, anstatt
weiterzumachen und möglicherweise unbrauchbare Berechnungen mit
unvollständigen oder beschädigten Daten durchzuführen. Ein weiterer
Vorteil ist, dass wir bei einem Fehlschlag eines Schrittes sicher dort
weitermachen können, wo wir aufgehört haben.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Hauptpunkte</h3>
<div class="callout-content">
<ul>
<li>“Snakemake verknüpft Regeln, indem es iterativ nach Regeln sucht,
die fehlende Eingaben machen”</li>
<li>“Regeln können mehrere benannte Eingänge und/oder Ausgänge
haben”</li>
<li>“Wenn ein Shell-Befehl nicht die erwartete Ausgabe liefert, wird
Snakemake dies als Fehler betrachten</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-06-expansion"><p>Content from <a href="06-expansion.html">Verarbeitung von Listen von Eingaben</a></p>
<hr>
<p>Zuletzt aktualisiert am 2024-11-25 |

        <a href="https://github.com/carpentries-incubator/hpc-workflows/edit/main/episodes/06-expansion.md" class="external-link">Diese Seite bearbeiten <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Geschätzte Zeit: <i aria-hidden="true" data-feather="clock"></i> 80 Minuten</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Alle Lösungen anzeigen " data-collapse="Alle Lösungen ausblenden "> Alle Lösungen anzeigen <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Übersicht</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Fragen</h3>
<ul>
<li>“Wie kann ich mehrere Dateien auf einmal verarbeiten?”</li>
<li>“Wie kombiniere ich mehrere Dateien miteinander?”</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Ziele</h3>
<ul>
<li>“Verwenden Sie Snakemake, um alle unsere Proben auf einmal zu
verarbeiten”</li>
<li>“Erstellen Sie ein Skalierbarkeitsdiagramm, das unsere Ergebnisse
zusammenfasst”</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Wir haben eine Regel erstellt, die eine einzige Ausgabedatei erzeugen
kann, aber wir werden nicht mehrere Regeln für jede Ausgabedatei
erstellen. Wir wollen alle Ausführungsdateien mit einer einzigen Regel
erzeugen, wenn es möglich ist, und Snakemake kann tatsächlich eine Liste
von Eingabedateien annehmen:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>rule generate_run_files:</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>    output: <span class="st">"p_</span><span class="sc">{parallel_proportion}</span><span class="st">_runs.txt"</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>    <span class="bu">input</span>:  <span class="st">"p_</span><span class="sc">{parallel_proportion}</span><span class="st">/runs/amdahl_run_2.json"</span>, <span class="st">"p_</span><span class="sc">{parallel_proportion}</span><span class="st">/runs/amdahl_run_6.json"</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    shell:</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>        <span class="co">"echo {input} done &gt; {output}"</span></span></code></pre>
</div>
<p>Das ist großartig, aber wir wollen nicht alle Dateien, an denen wir
interessiert sind, einzeln auflisten müssen. Wie können wir dies
tun?</p>
<section><h2 class="section-heading" id="definieren-einer-liste-von-zu-verarbeitenden-proben">Definieren einer Liste von zu verarbeitenden Proben<a class="anchor" aria-label="anchor" href="#definieren-einer-liste-von-zu-verarbeitenden-proben"></a>
</h2>
<hr class="half-width">
<p>Um dies zu tun, können wir einige Listen als Snakemake
<strong>globale Variablen</strong> definieren.</p>
<p>Globale Variablen sollten vor den Regeln in der Snakefile hinzugefügt
werden.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Task sizes we wish to run</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>NTASK_SIZES <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]</span></code></pre>
</div>
<ul>
<li>Anders als bei Variablen in Shell-Skripten können wir Leerzeichen um
das <code>=</code>-Zeichen setzen, aber sie sind nicht zwingend
erforderlich.</li>
<li>Die Listen der in Anführungszeichen gesetzten Zeichenketten werden
in eckige Klammern gesetzt und durch Kommata getrennt. Wenn Sie Python
kennen, werden Sie dies als Python-Listensyntax erkennen.</li>
<li>Eine gute Konvention ist die Verwendung von großgeschriebenen Namen
für diese Variablen, aber das ist nicht zwingend.</li>
<li>Obwohl diese als Variablen bezeichnet werden, können Sie die Werte
nicht mehr ändern, sobald der Arbeitsablauf läuft, so dass auf diese
Weise definierte Listen eher Konstanten sind.</li>
</ul></section><section><h2 class="section-heading" id="verwendung-einer-snakemake-regel-zur-definition-eines-stapels-von-ausgaben">Verwendung einer Snakemake-Regel zur Definition eines Stapels von
Ausgaben<a class="anchor" aria-label="anchor" href="#verwendung-einer-snakemake-regel-zur-definition-eines-stapels-von-ausgaben"></a>
</h2>
<hr class="half-width">
<p>Nun wollen wir unser Snakefile aktualisieren, um die neue globale
Variable zu nutzen und eine Liste von Dateien zu erstellen:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>rule generate_run_files:</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    output: <span class="st">"p_</span><span class="sc">{parallel_proportion}</span><span class="st">_runs.txt"</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    <span class="bu">input</span>:  expand(<span class="st">"p_</span><span class="sc">{{</span><span class="st">parallel_proportion</span><span class="sc">}}</span><span class="st">/runs/amdahl_run_</span><span class="sc">{count}</span><span class="st">.json"</span>, count<span class="op">=</span>NTASK_SIZES)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    shell:</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>        <span class="co">"echo {input} done &gt; {output}"</span></span></code></pre>
</div>
<p>Die Funktion <code>expand(...)</code> in dieser Regel erzeugt eine
Liste von Dateinamen, indem sie das erste Element in den einfachen
Klammern als Vorlage nimmt und <code>{count}</code> durch alle
<code>NTASK_SIZES</code> ersetzt. Da die Liste 5 Elemente enthält,
ergibt dies 5 Dateien, die wir erstellen wollen. Beachten Sie, dass wir
unseren Platzhalter in einem zweiten Satz von Klammern schützen mussten,
damit er nicht als etwas interpretiert wird, das erweitert werden
muss.</p>
<p>In unserem aktuellen Fall verlassen wir uns immer noch auf den
Dateinamen, um den Wert des Platzhalters
<code>parallel_proportion</code> zu definieren, also können wir die
Regel nicht direkt aufrufen, sondern müssen immer noch eine bestimmte
Datei anfordern:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">snakemake</span> <span class="at">--profile</span> cluster_profile/ p_0.999_runs.txt</span></code></pre>
</div>
<p>Wenn Sie beim Ausführen von Snakemake auf der Befehlszeile keinen
Namen für eine Zielregel oder Dateinamen angeben, wird standardmäßig
<strong>die erste Regel</strong> in der Snake-Datei als Ziel
verwendet.</p>
<div id="regeln-als-ziele" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="regeln-als-ziele" class="callout-inner">
<h3 class="callout-title">Regeln als Ziele</h3>
<div class="callout-content">
<p>Wenn Sie Snakemake den Namen einer Regel auf der Kommandozeile geben,
funktioniert das nur, wenn diese Regel <em>keine Platzhalter</em> in den
Ausgaben hat, weil Snakemake keine Möglichkeit hat, zu wissen, was die
gewünschten Platzhalter sein könnten. Sie erhalten die Fehlermeldung
“Target rules may not contain wildcards” Dies kann auch passieren, wenn
Sie in der Befehlszeile keine expliziten Ziele angeben und Snakemake
versucht, die erste im Snakefile definierte Regel auszuführen.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="regeln-die-mehrere-eingaben-kombinieren">Regeln, die mehrere Eingaben kombinieren<a class="anchor" aria-label="anchor" href="#regeln-die-mehrere-eingaben-kombinieren"></a>
</h2>
<hr class="half-width">
<p>Unsere <code>generate_run_files</code> Regel ist eine Regel, die eine
Liste von Eingabedateien annimmt. Die Länge dieser Liste ist nicht durch
die Regel festgelegt, sondern kann sich je nach <code>NTASK_SIZES</code>
ändern.</p>
<p>In unserem Arbeitsablauf besteht der letzte Schritt darin, alle
erzeugten Dateien zu einem Diagramm zusammenzufassen. Vielleicht haben
Sie schon gehört, dass einige Leute dafür eine Python-Bibliothek namens
<code>matplotlib</code> verwenden. Es würde den Rahmen dieses Tutorials
sprengen, das Python-Skript zu schreiben, um einen endgültigen Plot zu
erstellen, daher stellen wir Ihnen das Skript als Teil dieser Lektion
zur Verfügung. Sie können es herunterladen mit</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-O</span> https://ocaisa.github.io/hpc-workflows/files/plot_terse_amdahl_results.py</span></code></pre>
</div>
<p>Das Skript <code>plot_terse_amdahl_results.py</code> benötigt eine
Befehlszeile, die wie folgt aussieht:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">python</span> plot_terse_amdahl_results.py <span class="at">--output</span> <span class="op">&lt;</span>output image filename<span class="op">&gt;</span> <span class="op">&lt;</span>1st input file<span class="op">&gt;</span> <span class="op">&lt;</span>2nd input file<span class="op">&gt;</span> ...</span></code></pre>
</div>
<p>Lass uns das in unsere <code>generate_run_files</code> Regel
einfügen:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>rule generate_run_files:</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    output: <span class="st">"p_</span><span class="sc">{parallel_proportion}</span><span class="st">_runs.txt"</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="bu">input</span>:  expand(<span class="st">"p_</span><span class="sc">{{</span><span class="st">parallel_proportion</span><span class="sc">}}</span><span class="st">/runs/amdahl_run_</span><span class="sc">{count}</span><span class="st">.json"</span>, count<span class="op">=</span>NTASK_SIZES)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    shell:</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>        <span class="co">"python plot_terse_amdahl_results.py --output {output} {input}"</span></span></code></pre>
</div>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Aufgabe</h3>
<div class="callout-content">
<p>Dieses Skript verlässt sich auf <code>matplotlib</code>, ist es als
Umgebungsmodul verfügbar? Fügen Sie diese Bedingung zu unserer Regel
hinzu.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Zeige mir die Lösung </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>rule generate_run_files:</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>    output: <span class="st">"p_</span><span class="sc">{parallel_proportion}</span><span class="st">_scalability.jpg"</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>    <span class="bu">input</span>:  expand(<span class="st">"p_</span><span class="sc">{{</span><span class="st">parallel_proportion</span><span class="sc">}}</span><span class="st">/runs/amdahl_run_</span><span class="sc">{count}</span><span class="st">.json"</span>, count<span class="op">=</span>NTASK_SIZES)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>    envmodules:</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>      <span class="co">"matplotlib"</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    shell:</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>        <span class="co">"python plot_terse_amdahl_results.py --output {output} {input}"</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Jetzt können wir endlich ein Skalierungsdiagramm erstellen! Führen
Sie den letzten Snakemake-Befehl aus:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">snakemake</span> <span class="at">--profile</span> cluster_profile/ p_0.999_scalability.jpg</span></code></pre>
</div>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Aufgabe</h3>
<div class="callout-content">
<p>Erzeugen Sie das Skalierbarkeitsdiagramm für alle Werte von 1 bis 10
Kernen.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Zeige mir die Lösung </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>NTASK_SIZES <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Aufgabe</h3>
<div class="callout-content">
<p>Wiederholung des Arbeitsablaufs für einen <code>p</code>-Wert von
0,8</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Zeige mir die Lösung </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">snakemake</span> <span class="at">--profile</span> cluster_profile/ p_0.8_scalability.jpg</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="bonusrunde" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="bonusrunde" class="callout-inner">
<h3 class="callout-title">Bonusrunde</h3>
<div class="callout-content">
<p>Erstellen Sie eine endgültige Regel, die direkt aufgerufen werden
kann und ein Skalierungsdiagramm für 3 verschiedene Werte von
<code>p</code> erzeugt.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Hauptpunkte</h3>
<div class="callout-content">
<ul>
<li>“Verwenden Sie die Funktion <code>expand()</code>, um Listen von
Dateinamen zu erzeugen, die Sie kombinieren wollen”</li>
<li>“Jede <code>{input}</code> zu einer Regel kann eine Liste variabler
Länge sein”</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>Diese Lektion unterliegt dem <a href="CODE_OF_CONDUCT.html">Verhaltenskodex</a></p>
        <p>

        <a href="https://github.com/carpentries-incubator/hpc-workflows/edit/main/README.md" class="external-link">Auf GitHub bearbeiten</a>

	
        | <a href="https://github.com/carpentries-incubator/hpc-workflows/blob/main/CONTRIBUTING.md" class="external-link">Beitragen</a>
        | <a href="https://github.com/carpentries-incubator/hpc-workflows/" class="external-link">Quelle</a></p>
				<p><a href="https://github.com/carpentries-incubator/hpc-workflows/blob/main/CITATION.cff" class="external-link">Zitieren</a> | <a href="mailto:maintainers-hpc@lists.carpentries.org">Kontakt</a> | <a href="https://carpentries.org/about/" class="external-link">Über</a></p>
			</div>
			<div class="col-md-6">

        <p>Materialien lizenziert unter <a href="LICENSE.html">CC-BY 4.0</a> von den Autoren</p>

        <p>Vorlage lizenziert unter <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> von <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Erstellt mit <a href="https://github.com/carpentries/sandpaper/tree/0.16.10" class="external-link">sandpaper (0.16.10)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.7" class="external-link">pegboard (0.7.7)</a> und <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Zurück nach oben"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Zurück</span> nach oben
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries-incubator.github.io/hpc-workflows/instructor/aio.html",
  "inLanguage": "de",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "HPC Carpentry, snakemake, workflows, hpc",
  "name": "Alles auf einen Blick",
  "creativeWorkStatus": "active",
  "url": "https://carpentries-incubator.github.io/hpc-workflows/instructor/aio.html",
  "identifier": "https://carpentries-incubator.github.io/hpc-workflows/instructor/aio.html",
  "dateCreated": "2023-04-19",
  "dateModified": "2024-12-17",
  "datePublished": "2024-12-17"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

